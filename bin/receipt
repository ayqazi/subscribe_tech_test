#!/usr/bin/env ruby
# frozen_string_literal: true

load File.expand_path('../lib/boot.rb', __dir__)
require 'json'

require 'basket'
require 'basket_item'

input = JSON.parse($stdin.read)

basket_items = input.map do |item_data|
  BasketItem.new(quantity: item_data['quantity'],
                 name: item_data['name'],
                 imported: item_data['imported'] == true,
                 gross_unit_price_pence: (item_data['unitPrice'] * 100).to_i)
end

basket = Basket.new(basket_items)

puts basket.receipt_lines.join("\n")
